language: cpp

notifications:
  email: false

git:
  depth: 10

os: windows

language: cpp

env:
  global:
    - GTEST_COLOR=1
    - CMAKE_VERSION=3.12
    # - PROPOSAL_TEST_FILES=/home/travis/build/tudo-astroparticlephysics/PROPOSAL/build/tests/TestFiles
    - MSBUILD_PATH="C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin"


install:
  - choco install visualstudio2019buildtools --package-parameters "--add Microsoft.VisualStudio.Component.VC.Tools.x86.x64"
  - pip install conan
  - conan profile new default --detect
  # - conan profile update settings.compiler.libcxx=libstdc++11 default
  - mkdir build && cd build
  - conan install .. -o build_testing=True -o nlohmann_json:multiple_headers=True --build=missing
  - conan build ..
  - echo "Searching for test file path"
  - echo $(pwd)

script:
  - export PATH=$MSBUILD_PATH:$PATH
  - MSBuild.exe -p:Configuration=Release -p:Platform=x64 CppProject/CppProject.vcxproj
  - travis_wait 60 echo "wait until installation has finished."
  - ctest -j2 --verbose -E "(Brems|Photo|Epair|Mupair)"
