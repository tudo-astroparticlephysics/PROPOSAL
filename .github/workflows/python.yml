name: Check üêç pkg PROPOSAL.

on:
  push:
    branches:
      - main
    tags:
      - "**"
  pull_request:

env:
  CMAKE_TOOLCHAIN_FILE: build/conan_toolchain.cmake

jobs:
    build:
      runs-on: ${{ matrix.os }}
      strategy:
        matrix:
          include:
            - os : "ubuntu-latest"
            - os : "macos-latest"

      steps:
        - uses: actions/checkout@v2
        - name: Cache conan
          id: cache-conan
          uses: actions/cache@v2
          with:
            path: ~/.conan
            key: ${{ runner.os }}-cache-conan-${{ matrix.compiler }}-${{ hashFiles('conanfile.py') }}-key

        - name: Setup conan
          run: |
            python3 -m pip install conan
            conan profile detect

        - name: Install C++ dependencies using conan
          run: conan install . -o with_python=True -o with_testing=False --build=missing

        - name: Install Python üêç distributions üì¶
          run: python3 -m pip install .[tests]

        - name: run pytest
          run: python3 -m pytest tests/python -v
